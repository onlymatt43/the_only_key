<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>The Only Key</title>
    <style>
        body {
            margin: 0;
            background-color: white;
        }
        .fullscreen-img {
            width: 100vw;
            height: auto;
            display: block;
        }
        button, .custom-btn, a[role="button"], input#token-input {
            background: rgba(255,255,255,0.7);
            color: #008b8b;
            border: 2px solid #008b8b;
            font-weight: bold;
            border-radius: 8px;
            transition: background 0.2s, color 0.2s;
            cursor: pointer;
        }
        button:hover, .custom-btn:hover, a[role="button"]:hover {
            background: #008b8b !important;
            color: #fff !important;
        }
        a.get-code-btn {
            background: rgba(255,255,255,0.7);
            color: #e75480;
            border: 2px solid #e75480;
            font-weight: bold;
            border-radius: 8px;
            transition: background 0.2s, color 0.2s;
            cursor: pointer;
            position: fixed;
            left: 32px;
            bottom: 32px;
            z-index: 30;
            display: inline-block;
            padding: 14px 32px;
            font-size: 1.15em;
            text-decoration: none;
            box-shadow: 0 2px 8px #0002;
        }
        a.get-code-btn:hover {
            background: #e75480 !important;
            color: #fff !important;
        }
    </style>
</head>
<body>
    <div style="position:absolute;bottom:60px;left:32px;z-index:10;min-width:340px;">
        <div style="display:flex;flex-direction:row;align-items:flex-end;gap:18px;">
            <div style="display:flex;flex-direction:column;align-items:flex-start;">
                <button onclick="openScanner()" style="padding:14px 30px;font-size:1.1em;box-shadow:0 2px 8px #0002;">Scanner un QR code</button>
                <div id="qr-reader" style="width:320px;max-width:80vw;display:none;margin-top:18px;"></div>
            </div>
            <div style="display:flex;flex-direction:column;align-items:flex-start;">
                <input id="token-input" type="text" placeholder="Entrer ou scanner un code" style="padding:12px;font-size:1.2em;border-radius:8px;width:260px;max-width:80%;margin-bottom:10px;">
                <button onclick="autoLogin()" style="padding:12px 28px;font-size:1.1em;margin-bottom:12px;">Valider</button>
            </div>
            <a href="https://payhip.com/panobyonlymatt" target="_blank" class="get-code-btn">GET YOUR CODE</a>
        </div>
    </div>
    <img src="{{ url_for('static', filename='mypic.png') }}" alt="The Only Key" class="fullscreen-img">
    {% if show_roi_qr %}
    <div style="position:fixed;bottom:24px;right:24px;z-index:50;background:rgba(255,255,255,0.95);padding:18px 24px;border-radius:16px;box-shadow:0 2px 16px #0006;">
        <h3 style="color:#008b8b;margin-bottom:10px;">Scan QR ROI pour activer le super-admin</h3>
        <img src="{{ url_for('static', filename='roi_qr.png') }}" alt="QR ROI" style="width:180px;height:180px;">
        <div style="font-size:0.95em;color:#888;margin-top:8px;">Ce QR doit être scanné une seule fois sur mobile.<br>Ne pas partager ce QR.</div>
    </div>
    {% endif %}
    <div style="text-align:center;margin-top:18px;">
        <a href="/admin_qr" style="color:#888;font-size:0.9em;">Admin QR</a>
    </div>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <script>
    function autoLogin() {
        var token = document.getElementById('token-input').value.trim();
        if (!token) return;
        window.location.href = '/auto_login?token=' + encodeURIComponent(token);
    }

    let qrReader = null;
    function openScanner() {
        const qrDiv = document.getElementById('qr-reader');
        qrDiv.style.display = 'block';
        if (!qrReader) {
            qrReader = new Html5Qrcode("qr-reader");
        }
        qrReader.start(
            { facingMode: "environment" },
            { fps: 10, qrbox: 220 },
            qrCodeMessage => {
                document.getElementById('token-input').value = qrCodeMessage;
                qrReader.stop();
                qrDiv.style.display = 'none';
                autoLogin();
            },
            errorMessage => {}
        ).catch(err => {
            alert("Impossible d'accéder à la caméra : " + err);
        });
    }
    </script>
</body>
</html>